# 商城功能文档说明与回顾
## 一、商城功能
### 1.1 C 端
* 用户模块
  * 登录
  * 注册
  * 退出
* 优惠卷模块
  * 浏览优惠卷
  * 领取优惠卷（用户只能领取一张未过期的优惠卷，并且只能使用一次）
* 商品模块
  * 浏览商品
  * 下单（默认使用用户未过期优惠券，如果优惠券金额大于商品金额，不可使用）
> 优惠卷一人一卷测试，同一个用户开启 50 个线程同时去抢卷，实现效果只有一个线程能成功抢到优惠卷

> 优惠卷 50 个用户抢购，没有出现库存变为负数的情况

> 下单操作，50 个并发用户，抢购库存为 30 的商品，同样没有出现库存为 0 的情况，优惠卷也能正确消费

> 通过上层服务创建订单流水号，用 redis 的缓存订单流水号，保证了由于服务超时订单创建的幂等性问题
### 1.2 web 端
* 管理员模块
  * 验证码获取（采用 cookie 标记标记当前用户的验证码的唯一性）
  * 登录
    * 一方登录，另一方要强制下线
    * 返回当前登录用户的 token 和权限菜单树
  * 回显用户信息
  * 忘记密码
    * 发送邮件，实现邮箱验证码验证（限流：每个邮箱每小时只能获取五次验证码）
    * 重置密码（邮件、验证码、两次输入的新密码校验）
  * 修改用户名（唯一性校验）
  * 修改密码
  * 修改邮箱（校验邮箱唯一性和密码的正确性，新邮箱验证码的校验）
  
* 首页
  * 近 x 天活跃用户数
  * 近 x 天新增用户数
> 返回 x 天的日期和当前活跃/新增用户数，即使如果某天活跃/新增用户数为 0，也可以让日期连续起来

* 角色模块
  * 浏览角色列表
  * 新建角色，关联权限
  * 查看角色和其关联的权限
  * 修改角色
  * 删除角色，如果有关联用户，删除失败
> 后端逻辑实现了权限的选中效果，selected 为 true 表示拥有当前权限

* 成员模块
  * 浏览成员列表
  * 新增用户，可关联一个角色（不能是超管）
  * 修改用户，可冻结用户以及修改其关联角色
    * 如果被冻结用户处于在线状态，可实现踢人下线
  * 删除用户
> 其中角色模块与成员管理的修改和删除是专属于超级管理员的权限，在这四个接口上标记了 `@isAdmin`
注解，并通过登录拦截器进行了校验。其余权限的校验逻辑则是在登录拦截器里面通过 redis set 集合完成的

* 商品模块
  * 新增
  * 删除（如果有订单关联商品，不可删除）
  * 浏览商品
  * 修改
  * 批量导入（同步校验表头，异步处理表单数据）
  * 浏览导入记录
  * 导入反馈文件的下载

* 优惠卷模块
  * 新增
  * 浏览优惠卷

* 日志操作
  * 浏览日志

  
### 1.3 限流与日志记录的实现
* 限流
  * 通过 aop 与注解配合 redis + lua 脚本实现
    * 可实现针对接口、IP、用户级别限流
    * 限流注解可操作性高，key 支持 el 表达式动态获取当前方法参数作为 key
    
* 日志记录
  * 在目标方法执行后，记录方法被成功执行的日志
  * 采用枚举作为日志注解类型的属性，支持 el 表达式，可以动态获取方法参数作为日志内容



## 二、文档地址
* swagger-ui: http://192.168.26.161:7375/swagger-ui.html#/
* api 文档：http://192.168.26.128/pages/viewpage.action?pageId=66945152